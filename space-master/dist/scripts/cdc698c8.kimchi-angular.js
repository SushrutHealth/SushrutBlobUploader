angular.module("kimchi",["ngSanitize","ui.bootstrap"]),angular.module("kimchi").factory("KIMCHI",["$window",function(a){return a.KIMCHI}]),angular.module("kimchi").factory("THREE",["$window",function(a){return a.THREE}]),angular.module("kimchi").run(["$window","KIMCHI",function(a,b){b.ready(),angular.element(a).bind("resize",function(){b.size.update(),b.renderer.render()})}]),angular.module("kimchi").controller("BodiesCtrl",["$scope","$timeout","KIMCHI",function(a,b,c){a.bodies=_.values(c.space.bodies),a.distanceToCamera=function(a){return a.getDistance(c.camera)},a.panTo=function(d){c.flight.modes.orbit.updateTargetBody(d),a.setMode("auto").panTo(d).then(function(){b(function(){c.flight.setMode("pointerLock")})})},a.flyTo=function(d){c.flight.modes.orbit.updateTargetBody(d),a.setMode("auto").flyTo(d).then(function(){b(function(){c.flight.setMode("pointerLock")})})},a.orbit=function(d){c.flight.modes.orbit.updateTargetBody(d),a.setMode("auto").flyTo(d).then(function(){b(function(){a.setMode("orbit")})})}}]),angular.module("kimchi").controller("BodyCtrl",["$scope","KIMCHI",function(a,b){a.KIMCHI=b,a.loaded=!1,b.ready.promise.then(function(){a.loaded=!0})}]),angular.module("kimchi").controller("DebugCtrl",["$scope","$timeout","KIMCHI",function(a,b,c){var d,e,f;a.data={},d=function(){b(function(){e=c.camera.position,f=c.camera.rotation,a.data.delta=c.format.roundDecimals(c.renderer.delta,4,!0),a.data.position=Math.round(e.x)+", "+Math.round(e.y)+", "+Math.round(e.z),a.data.rotation=c.format.angle(f.x)+", "+c.format.angle(f.y)+", "+c.format.angle(f.z)})},c.on("render",d),a.$on("$destroy",function(){c.off("render",d)}),a.settings={visible:c.config.get("debug")}}]),angular.module("kimchi").controller("LabelsCtrl",["$scope","KIMCHI",function(a,b){a.labels={},b.init.promise.then(function(){_.each(b.space.bodies,function(b){a.labels[b.name]={name:b.name,css:{}}})}),b.on("render",function(){if(b.config.get("showLabels")){var c,d,e=b.space.getSortedDistances();_.each(b.space.bodies,function(b){c=a.labels[b.name],d=b.getCanvasCoords(),d?(c.css.left=d.x+"px",c.css.top=d.y+"px",c.css.zIndex=100+_.findIndex(e,{name:b.name}),c.show=!0):c.show=!1})}})}]),angular.module("kimchi").controller("NoticesCtrl",["$scope","KIMCHI",function(a,b){b.on("noticesChanged",function(b){a.notices=_.each(b,function(a){switch(a.type){case"error":a["class"]="alert-danger";break;case"notice":a["class"]="alert-success"}})})}]),angular.module("kimchi").controller("OptionsCtrl",["$scope","$document","KIMCHI",function(a,b,c){var d,e,f;e=["rotateBodies","ambientLight","showLabels","showOrbits","showStars","controlsKeyboardSpeedMultiplier","controlsLookSpeed"],f=["daysPerSecond","bodiesSizeScale"],d=e.concat(f),a.options={daysPerSecond:[{value:0,label:"Pause"},{value:1,label:"1"},{value:7,label:"7"},{value:20,label:"20"},{value:60,label:"60"},{value:365,label:"365"},{value:3650,label:"3650"}],bodiesSizeScale:[{value:1,label:"1x"},{value:10,label:"10x"},{value:100,label:"100x"},{value:1e3,label:"1000x"},{value:"large",label:"Large"}]},c.init.promise.then(function(){_.each(e,function(b){a[b]=c.config.get(b),a.$watch(b,function(a){c.config.set(b,a)})}),_.each(f,function(b){a[b]=_.find(a.options[b],{value:c.config.get(b)}),a.$watch(b,function(a){c.config.set(b,a.value)})}),c.renderer.render()}),b.on("keypress",function(a){switch(a.which){case 32:c.config.get("daysPerSecond")>0?c.config.set("daysPerSecond",0):c.config.set("daysPerSecond",c.config.get("prevDaysPerSecond"))}})}]),angular.module("kimchi").controller("PanelsCtrl",["$scope","$document","KIMCHI",function(a,b,c){var d,e;a.panels={about:!0,bodies:!1,options:!1},a.setMode=function(a){return d(),c.flight.setMode(a)},a.showPanel=function(b){d(),a.panels[b]=!a.panels[b]},b.on("keypress",function(b){switch(b.which){case 49:e()&&(c.flight.setMode("orbit"),a.panels.about=!0);break;case 50:a.setMode("pointerLock");break;case 51:a.setMode("orbit")}}),d=function(){_.each(a.panels,function(b,c){a.panels[c]=!1})},e=function(){return _.every(a.panels,function(a){return!a})}}]),angular.module("kimchi").controller("StatsCtrl",["$scope","$timeout","KIMCHI",function(a,b,c){var d;a.data={},d=function(){b(function(){a.data.time=c.format.time(),a.data.distanceFromSun=c.format.roundNicely(c.space.getBody("Sun").getDistance(c.camera),2,!0),a.data.speed=c.format.roundDecimals(c.flight.getSpeed(),2,!0)})},c.on("render",d),a.$on("$destroy",function(){c.off("render",d)})}]),angular.module("kimchi").directive("panel",function(){return{restrict:"E",transclude:!0,scope:!0,template:'<div class="panel panel-success" ng-show="panels[key]" stop-propagation="mousedown"><div class="panel-heading"><button type="button" class="close" aria-hidden="true" ng-click="panels[key] = false">&times;</button><h2 class="panel-title">{{title}}</h3></div><div class="panel-body" ng-transclude></div></div>',link:function(a,b,c){a.key=c.key,a.title=c.title}}}),angular.module("kimchi").directive("stopPropagation",function(){return function(a,b,c){b.on(c.stopPropagation,function(a){a.stopPropagation()})}});